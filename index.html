<script>
    document.querySelector('.hamburger').addEventListener('click', () => {
        document.querySelector('.nav-links').classList.toggle('active');
    });

    document.addEventListener('DOMContentLoaded', () => {
        const video = document.getElementById('header-video');
        const playBtn = document.getElementById('play-video');
        const hiddenTexts = document.querySelectorAll('.hidden-text');
        const hiddenElements = document.querySelectorAll('.hidden-element');
        let textRevealed = false;
        let logoStarted = false;

        // Attempt to play video
        const playPromise = video.play();
        if (playPromise !== undefined) {
            playPromise
                .then(() => {
                    playBtn.classList.add('hidden');
                })
                .catch(() => {
                    playBtn.classList.remove('hidden');
                    revealTextAndElements();
                });
        }

        // Play button click handler
        playBtn.addEventListener('click', () => {
            video.play().then(() => {
                playBtn.classList.add('hidden');
            });
        });

        // Handle video timing
        video.addEventListener('timeupdate', () => {
            if (video.currentTime >= 3 && !textRevealed) {
                video.style.opacity = '0';
                revealTextAndElements();
                textRevealed = true;
            }
            if (video.duration - video.currentTime <= 1 && !logoStarted) {
                startLogoAnimation();
                logoStarted = true;
            }
        });

        // Hide video after it ends
        video.onended = () => {
            video.style.display = 'none';
        };

        // Fallback: Reveal text if video doesn't progress after 5s
        setTimeout(() => {
            if (!textRevealed) {
                revealTextAndElements();
                textRevealed = true;
            }
        }, 5000);

        function revealTextAndElements() {
            hiddenTexts.forEach(text => {
                text.style.opacity = '1';
                text.style.transition = 'opacity 0.5s ease-in';
            });
            hiddenElements.forEach(element => {
                element.style.opacity = '1';
                element.style.transition = 'opacity 0.5s ease-in';
            });
        }

        function startLogoAnimation() {
            // Logo animation handled by CSS
        }

        // Scroll-based orange outline on mobile
        const sections = document.querySelectorAll('.stats, .testimonials, .strategies, .highlights, .about');
        
        function checkSectionPosition() {
            if (window.innerWidth > 768) return; // Only on mobile

            const viewportHeight = window.innerHeight;
            const viewportCenter = viewportHeight / 2;

            sections.forEach(section => {
                const rect = section.getBoundingClientRect();
                const sectionHeight = rect.height;
                const sectionMidpoint = rect.top + (sectionHeight / 2);

                // Check if the section's midpoint is near the viewport center
                if (sectionMidpoint > viewportCenter - 50 && sectionMidpoint < viewportCenter + 50) {
                    section.classList.add('active-card');
                } else {
                    section.classList.remove('active-card');
                }
            });
        }

        // Add scroll and resize listeners
        window.addEventListener('scroll', checkSectionPosition);
        window.addEventListener('resize', checkSectionPosition);
        checkSectionPosition(); // Initial check
    });
</script>
